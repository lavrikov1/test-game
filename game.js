function playAudio(n){let t=new Audio(n);t.play()}function checkEnemyTargetCollision(n,t){const i=Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2));return i<n.radius+t.radius}function alfLogo(){ctx.globalAlpha=.04;ctx.drawImage(alfredLogo,logoX,logoY,logoWidth,logoHeight);ctx.beginPath();ctx.stroke()}function enemyCoinLevel1(n,t,i){let r=screenWidth/sizeEnemy,u=screenWidth/sizeEnemy;ctx.globalAlpha=1;ctx.drawImage(imageEnemyCoin,n-r/2,t-u/2,r,u);ctx.beginPath();ctx.ellipse(n,t,i,i,Math.PI/4,0,2*Math.PI);ctx.strokeStyle="#ff0000";ctx.globalAlpha=0;ctx.stroke()}function target(n,t,i,r,u){let o=Math.atan2(u-t,r-n)+Math.PI/2;ctx.save();ctx.translate(n,t);ctx.rotate(o);let f=70,e=78;ctx.globalAlpha=1;ctx.drawImage(imageTarget,-f/2,-e/2,f,e);ctx.restore();color="#ff0000";ctx.beginPath();ctx.ellipse(n,t,i,i,Math.PI/4,0,2*Math.PI);ctx.globalAlpha=0;ctx.strokeStyle=color;ctx.stroke()}function bullet(n,t,i,r,u){let f=20,e=20,o=Math.atan2(r,i)+Math.PI/2;ctx.save();ctx.translate(n,t);ctx.rotate(o);ctx.globalAlpha=1;ctx.drawImage(imageBullet,-f/2,-e/2,f,e);ctx.restore();ctx.beginPath();ctx.ellipse(n,t,u,u,Math.PI/4,0,2*Math.PI);ctx.strokeStyle="#ff0000";ctx.globalAlpha=0;ctx.stroke()}function onShotFired(){shotsFired++;updateRectangleWidth(shotsFired,maxShots)}function createFloatingText(n,t,i,r="#E0FFFF"){var u=document.createElement("div"),f;u.textContent=n;u.className="floatingText";u.style.color=r;document.body.appendChild(u);f=u.getBoundingClientRect();t=Math.min(t,window.innerWidth-f.width);i=Math.min(i,window.innerHeight-f.height);u.style.left=t+"px";u.style.top=i+"px";u.addEventListener("animationend",function(){u.remove()})}function render(){ctx.clearRect(0,0,canvas.width,canvas.height);alfLogo();let n={x:0,y:0,distance:1e4};for(const t in listEnemy)if(listEnemy.hasOwnProperty(t)){const i=listEnemy[t];let u=i.x,f=i.y;const r=moveObjectTowardsDirection(i.x,i.y,targetObject.x,targetObject.y,i.speedEnemy);i.x=r.x;i.y=r.y;enemyCoinLevel1(i.x,i.y,i.radius.radius);r.distance<n.distance&&(n={x:u,y:f,distance:r.distance})}for(const n in listBullet)if(listBullet.hasOwnProperty(n)){const t=listBullet[n];let i=t.x,r=t.y;t.x+=t.dx*20;t.y+=t.dy*20;bullet(t.x,t.y,t.dx,t.dy,t.radius);for(const n in listEnemy)if(listEnemy.hasOwnProperty(n)){const i=listEnemy[n];checkEnemyTargetCollision(t,i)&&listEnemy.hasOwnProperty(i.id)&&(Telegram.WebApp.HapticFeedback.impactOccurred("medium"),onShotFired(),textDivCountCoin2.innerText=coinsLeft-=1,createFloatingText("+1",i.x,i.y),playAudio("audio/kill-coin.ogg"),delete listEnemy[i.id],delete listBullet[t.id],textDiv.innerText=countDead+=1)}}for(const n in listEnemy)if(listEnemy.hasOwnProperty(n)){const t=listEnemy[n];checkEnemyTargetCollision(targetObject,t)&&listEnemy.hasOwnProperty(t.id)&&(createFloatingText("-5",t.x,t.y,"#FF0000"),playAudio("audio/kill-target.ogg"),onShotFired(),textDivCountCoin2.innerText=coinsLeft-=1,delete listEnemy[t.id],textDiv.innerText=countDead-=5,cheklLevel+=1)}const t=targetMoveObjectAwayFromDirection(targetObject.x,targetObject.y,n.x,n.y,.8);let s=t.x,h=t.y;targetObject.x=s;targetObject.y=h;const i=screenWidth*.2,c=screenHeight*.2,l=screenHeight*.3,r=i,u=screenWidth-i,f=c,e=screenHeight-l;targetObject.y+targetObject.radius>=e?(targetObject.y=e-targetObject.radius,targetObject.dy*=-1):targetObject.y-targetObject.radius<=f&&(targetObject.y=f+targetObject.radius,targetObject.dy*=-1);targetObject.x+targetObject.radius>=u?(targetObject.x=u-targetObject.radius,targetObject.dx*=-1):targetObject.x-targetObject.radius<=r&&(targetObject.x=r+targetObject.radius,targetObject.dx*=-1);target(targetObject.x,targetObject.y,targetObject.radius,targetObject.directionX,targetObject.directionY);checkEnemyTargetCollision(enemyCoinObject,targetObject);const o=moveObjectTowardsDirection(bulletObject.x,bulletObject.y,targetObject.x,targetObject.y,.3);bulletObject.x=o.x;bulletObject.y=o.y;window.requestAnimationFrame(render)}function startAnimation(){window.requestAnimationFrame(render)}function handleTouch(n){if(n.preventDefault(),n.type==="touchend"&&n.touches.length===0){strike=!1;return}let t=n.type==="touchend"?n.changedTouches[0]:n.touches[0];const i=t.clientX,r=t.clientY;fireX=i;fireY=r;targetObject.directionX=i;targetObject.directionY=r;strike=n.type==="touchmove"?!0:!0}function moveObjectTowardsDirection(n,t,i,r,u){const f=i-n,e=r-t;let s=Math.abs(f)+Math.abs(e);const o=Math.atan2(e,f),h=n+Math.cos(o)*u,c=t+Math.sin(o)*u;return{x:h,y:c,distance:s}}function targetMoveObjectAwayFromDirection(n,t,i,r,u){const e=i-n,o=r-t,f=Math.atan2(o,e),s=n-Math.cos(f)*u,h=t-Math.sin(f)*u;return{x:s,y:h}}function generateRandomEnemyName(n){for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",u=i.length,r=0;r<n;r++)t+=i.charAt(Math.floor(Math.random()*u));return t}function countNestedObjects(n){let t=0;for(const i in n)typeof n[i]!="object"||Array.isArray(n[i])||(t++,t+=countNestedObjects(n[i]));return t}function setSpeedEnemyCoin(){return Math.random()*(maxSpeedEnemyCoin-minSpeedEnemyCoin)+minSpeedEnemyCoin}var screenWidth,screenHeight,container,shotsFired,maxShots,textDiv,rectHp,textDivCountCoin,textDivCountCoin2,imgCoin;let userMute=!1;let speed_alfred=500;const allEnemyCoin=[];screenWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;screenHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let maxScreenWidthToNumber=screenWidth-30,maxScreenHeightToNumber=screenHeight-30,minScreenWidthToNumber=screenWidth+30,minScreenHeightToNumber=screenHeight+30,speed_enemy_coin=300,maxCountEnemyCoin=2,priceEnemyCoin=1,enemyCoinHeight=Math.round(5/100*screenHeight);container=document.createElement("div");container.id="image-container";container.style.backgroundColor="#181A20";document.body.appendChild(container);let canvas=document.createElement("canvas");canvas.width=screenWidth;canvas.height=screenHeight;container.appendChild(canvas);let ctx=canvas.getContext("2d"),imageEnemyCoin=new Image;imageEnemyCoin.src="img/test-coin.svg";let sizeEnemy=15,alfredLogo=new Image;alfredLogo.src="img/alfred.png";let imageBullet=new Image;imageBullet.src="img/bullet.png";let strike=!1,imageTarget=new Image;imageTarget.src="img/logo_for_site.png";imageTarget.style.width="10vh";imageTarget.style.height="auto";imageTarget.style.top="50%";imageTarget.style.left="50%";let logoWidth=388,logoHeight=480,logoX=screenWidth/2-logoWidth/2,logoY=screenHeight/2-logoHeight/2;let enemyCoinObject={x:20,y:20,dx:1,dy:1,radius:20},targetObject={x:180,y:300,dx:.8,dy:.4,directionX:130,directionY:80,radius:36},bulletObject={x:150,y:150,dx:1,dy:1,radius:5};const listEnemy={},listBullet={};let fireX=0,fireY=0,countDead=15,cheklLevel=0,countCoinToSecond=3;shotsFired=0;maxShots=1e3;textDiv=document.createElement("div");textDiv.id="count-nerual";textDiv.style.position="absolute";textDiv.style.top="10px";textDiv.style.left="10px";textDiv.style.color="white";textDiv.style.zIndex="10";textDiv.className="rectangle";textDiv.innerText=countDead;container.appendChild(textDiv);rectHp=document.createElement("div");rectHp.id="rectangleHp2";rectHp.className="rectangleHp2";container.appendChild(rectHp);rectHp=document.createElement("div");rectHp.id="rectangleHp";rectHp.className="rectangleHp";container.appendChild(rectHp);textDivCountCoin=document.createElement("div");textDivCountCoin.id="countCoin";textDivCountCoin.style.position="absolute";textDivCountCoin.style.bottom="25px";textDivCountCoin.style.left="50px";textDivCountCoin.style.color="white";textDivCountCoin.style.zIndex="1001";textDivCountCoin.className="rectangleHp3";textDivCountCoin.innerText="/ 1000";container.appendChild(textDivCountCoin);let coinsLeft=1e3;textDivCountCoin2=document.createElement("div");textDivCountCoin2.id="countCoin2";textDivCountCoin2.style.position="absolute";textDivCountCoin2.style.bottom="40px";textDivCountCoin2.style.left="50px";textDivCountCoin2.style.color="white";textDivCountCoin2.style.zIndex="1001";textDivCountCoin2.className="rectangleHp4";textDivCountCoin2.innerText=coinsLeft;container.appendChild(textDivCountCoin2);imgCoin=document.createElement("img");imgCoin.src="img/test-coin.svg";imgCoin.style.position="absolute";imgCoin.id="rotatingImage";imgCoin.style.width="35px";imgCoin.style.height="35px";imgCoin.style.bottom="32px";imgCoin.style.zIndex="1010";imgCoin.style.left="10px";document.body.appendChild(imgCoin);window.addEventListener("load",startAnimation);setInterval(function(){function t(n,t,i,r){const f=i-n,e=r-t,u=Math.atan2(e,f);return{dx:Math.cos(u),dy:Math.sin(u)}}const n=t(targetObject.x,targetObject.y,fireX,fireY);if(strike==!0){const t={id:generateRandomEnemyName(15),x:targetObject.x,y:targetObject.y,dx:n.dx,dy:n.dy,radius:5};listBullet[t.id]=t}},100);const element=document.getElementById("image-container");element.addEventListener("touchstart",handleTouch);element.addEventListener("touchmove",handleTouch);element.addEventListener("touchend",handleTouch);let minSpeedEnemyCoin=.4,maxSpeedEnemyCoin=1.6;setInterval(function(){cheklLevel<=3&&(cheklLevel=0,maxSpeedEnemyCoin+=.4);maxSpeedEnemyCoin>=2.4&&maxSpeedEnemyCoin<=3&&maxCountEnemyCoin==3&&maxCountEnemyCoin<6&&(maxCountEnemyCoin+=1)},15e3);setInterval(function(){cheklLevel>=4&&(maxSpeedEnemyCoin=1.6,maxCountEnemyCoin=3,cheklLevel=0)},3e3);setInterval(function(){function t(){let n=Math.floor(Math.random()*4);n==0?(x=0-screenWidth/sizeEnemy,y=Math.floor(Math.random()*(+screenHeight+1))+0):n==1?(x=Math.floor(Math.random()*(+screenWidth+1))+0,y=0-screenHeight/sizeEnemy):n==3?(x=screenWidth+screenWidth/sizeEnemy,y=Math.floor(Math.random()*(+screenHeight+1))+0):(x=Math.floor(Math.random()*(+screenWidth+1))+0,y=screenHeight+screenHeight/sizeEnemy);return{x:x,y:y}}let n=countNestedObjects(listEnemy);for(let i=0;i<countCoinToSecond;i++)if(n<20&&maxShots>0){let n=t();const i={id:generateRandomEnemyName(15),x:n.x,y:n.y,dx:1,dy:1,speedEnemy:setSpeedEnemyCoin(),radius:20};listEnemy[i.id]=i}},1e3);
